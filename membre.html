<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>G.I.G.O.T — Espace membres</title>
  <meta name="description" content="Espace membres G.I.G.O.T (accès restreint aux membres Discord autorisés)." />

  <!-- Polices -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- CSP identique à index.html -->
  <meta http-equiv="Content-Security-Policy" 
  content="
    default-src 'self';
    script-src 'self' https://cdn.jsdelivr.net https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com data:;
    img-src 'self' data:;
    connect-src 'self' https://fjhsakmjcdqpolccihyj.supabase.co;
    object-src 'none';
    base-uri 'self';
    upgrade-insecure-requests;
  ">

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" defer></script>
  <!-- App logic partagée -->
  <script src="./app.js?v=members-guard" defer></script>
  <!-- Helpers spécifiques page membres (redirection/guard) -->
  <script src="./members.js?v=1" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body>
  <header class="site-header">
    <div class="container nav-wrap">
      <a href="./index.html" class="logo" aria-label="Accueil G.I.G.O.T">
        <span class="logo-mark"><img src="img/logoGIGOT.png" alt="Logo G.I.G.O.T" class="logo-img"></span>
        <span class="logo-text">G.I.G.O.T</span>
      </a>
      <nav aria-label="Navigation principale">
        <ul class="nav">
          <li><a href="./index.html#histoire">Histoire</a></li>
          <li><a href="./index.html#divisions">Divisions</a></li>
          <li><a href="./index.html#fonctionnement">Fonctionnement</a></li>
          <li><a href="./index.html#recrutement">Recrutement</a></li>
          <li class="nav-cta">
            <div class="cta">
              <button class="btn btn-primary" id="btn-login">Se connecter avec Discord</button>
              <button class="btn btn-ghost" id="btn-logout">Se déconnecter</button>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="content" class="site-main">
    <section class="section">
      <div class="container">
        <h2>Espace membres</h2>
        <p class="lead">Accès réservé aux membres reconnus sur le Discord. Redirection automatique si l’accès n’est pas validé.</p>
      </div>
    </section>

    <!-- visible uniquement si l’utilisateur est dans la guilde + a un rôle autorisé -->
    <section class="section" data-protected>
      <div class="container">

        <!-- Inventaire -->
        <section id="inventaire" class="section">
          <div class="container">
            <h2>Inventaire</h2>

            <!-- Recherche -->
            <input type="text" id="search" placeholder="Rechercher..." />

            <!-- Tableau -->
            <table id="inv-table">
              <thead>
                <tr>
                  <th data-col="type">Type</th>
                  <th data-col="name">Item</th>
                  <th data-col="location">Lieu</th>
                  <th data-col="owner">Possesseur</th>
                  <th data-col="unit_price">Prix unitaire</th>
                  <th data-col="qty">Quantité</th>
                  <th data-col="valeur_totale">Valeur totale</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="inv-body"></tbody>
            </table>

            <!-- Pagination -->
            <div id="pagination"></div>

            <!-- Bouton ajout -->
            <button id="btn-add" class="btn btn-primary">➕ Ajouter</button>
          </div>
        </section>

<!-- Modal Inventaire -->
<div id="modal" class="modal" style="display:none">
  <div class="modal-dialog">
    <h3 id="modal-title">Nouvel item</h3>
    <form id="form-item">
      <input type="hidden" id="item-id" />

      <div class="form-row">
        <label for="item-type">Type</label>
        <input id="item-type" type="text" required list="dl-type" placeholder="ex: Armure, Composant..." />
      </div>

      <div class="form-row">
        <label for="item-name">Item</label>
        <input id="item-name" type="text" required list="dl-item" placeholder="ex: Perle de Valakar" />
      </div>

      <div class="form-row">
        <label for="item-location">Lieu</label>
        <input id="item-location" type="text" list="dl-location" placeholder="ex: New Babbage" />
      </div>

      <div class="form-row">
        <label for="item-owner">Possesseur</label>
        <input id="item-owner" type="text" list="dl-owner" placeholder="ex: Pseudo" />
      </div>

      <div class="form-row">
        <label for="item-unit_price">Prix unitaire (aUEC)</label>
        <input id="item-unit_price" type="number" step="1" min="0" placeholder="0" />
      </div>

      <div class="form-row">
        <label for="item-qty">Quantité</label>
        <input id="item-qty" type="number" step="1" min="0" value="1" />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Enregistrer</button>
        <button type="button" id="btn-cancel" class="btn btn-ghost">Annuler</button>
      </div>
    </form>

    <!-- Datalists nécessaires (remplis par app.js / loadDatalists) -->
    <datalist id="dl-type"></datalist>
    <datalist id="dl-item"></datalist>
    <datalist id="dl-location"></datalist>
    <datalist id="dl-owner"></datalist>
  </div>
</div>


        <!-- CAISSE NOIRE -->
        <section id="cashbox" class="section">
          <div class="container">
            <h2>Caisse noire</h2>

            <div id="cashbox-summary" class="card">
              <div class="row">
                <strong>Solde actuel :</strong>
                <span id="cashbox-balance" aria-live="polite">— aUEC</span>
              </div>
              <p class="muted">Somme des dons moins les dépenses. Visible par tous les membres.</p>
            </div>

            <!-- Dons -->
            <article class="card">
              <header class="card-head">
                <h3>Suivi des dons</h3>
                <div class="actions" data-staff>
                  <button id="btn-add-donation" class="btn btn-primary">+ Ajouter un don</button>
                </div>
              </header>
              <div class="table-wrap">
                <table id="donations-table" class="table">
                  <thead>
                    <tr>
                      <th>Donateur·rice</th>
                      <th>Montant (aUEC)</th>
                      <th>Date</th>
                      <th>Notes</th>
                      <th data-staff>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="donations-body"></tbody>
                </table>
              </div>
              <div class="pagination" id="donations-pager"></div>
            </article>

            <!-- Dépenses -->
            <article class="card">
              <header class="card-head">
                <h3>Historique des mouvements (dépenses)</h3>
                <div class="actions" data-staff>
                  <button id="btn-add-expense" class="btn btn-primary">+ Ajouter une dépense</button>
                </div>
              </header>
              <div class="table-wrap">
                <table id="expenses-table" class="table">
                  <thead>
                    <tr>
                      <th>Raison / Objet</th>
                      <th>Montant (aUEC)</th>
                      <th>Date</th>
                      <th>Justif / Notes</th>
                      <th data-staff>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="expenses-body"></tbody>
                </table>
              </div>
              <div class="pagination" id="expenses-pager"></div>
            </article>
          </div>
        </section>

        <!-- Modals (réutilise le même modal système que l’inventaire si tu veux) -->
        <div id="cashbox-modal" class="modal" hidden>
          <div class="modal-dialog">
            <h3 id="cashbox-modal-title">Ajouter</h3>
            <form id="cashbox-form">
              <!-- champs injectés dynamiquement -->
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">Enregistrer</button>
                <button type="button" class="btn btn-ghost" id="cashbox-cancel">Annuler</button>
              </div>
            </form>
          </div>
        </div>

    <section id="cashbox-charts" class="section">
      <div class="container">
        <h2>Répartition des dons par personne</h2>

        <div class="toolbar">
          <label for="donations-period" class="sr-only">Période</label>
          <select id="donations-period" aria-label="Période">
            <option value="all">Tout</option>
            <option value="30">30 jours</option>
            <option value="90">90 jours</option>
            <option value="365">12 mois</option>
            <option value="ytd">Année en cours</option>
          </select>
        </div>

        <div class="chart-row">
          <canvas id="donations-by-person-pie" width="480" height="480" aria-label="Répartition des dons par personne" role="img"></canvas>
        </div>

        <div id="donations-pie-fallback" class="muted" style="display:none">Aucune donnée disponible.</div>
        <div id="donations-pie-summary" class="muted"></div>
      </div>
    </section>

        

    <!-- visible uniquement si rôle staff -->
    <section class="section" data-staff>
      <div class="container">
        <h2>Staff</h2>
        <p>Outils et infos pour l’équipe staff.</p>
      </div>
    </section>

    
  </main>

  <footer class="site-footer">
    <div class="container foot">
      <p>© <span id="year"></span> G.I.G.O.T — L’absurde, organisé.</p>
      <a href="#content" class="to-top" aria-label="Revenir en haut">↑ Haut de page</a>
    </div>
  </footer>
</body>
</html>
